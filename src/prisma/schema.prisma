// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["interactiveTransactions"]
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id          Int      @id @default(autoincrement())
  email       String   @unique /// 로그인시 사용될 email 형태의 id ex) "hawaii@gmail.com"
  password    String /// 로그인시 사용될 비밀번호, 조합 규칙은 영문자/숫자+특수기호 20자리까지, 영문자/숫자는 반드시 포함되어야 하며, '₩'와 '\'와 공백을 제외한 특수기호는 인정은 하지만 반드시 포함은 아님. ex) "qwer1234"
  phone       String /// 국제번호를 포함하고 '-' 기호를 제외한 문자 형태의 숫자 , ex) +821012345678
  nickName    String /// 사용할 닉네임, 20자 제한 ex) 유쾌한인어
  countryCode String /// 두글자 ISO Country Code 기준 https://countrycode.org/ 대문자로 한정 ex) KR, US
  userTokenId String   @unique /// 비회원이었을 시절의 유저 토큰 payload중 tokenId 값, 이것으로 비회원 이었을때의 데이터가 회원 데이터로 승계된다. ex) 2, 727
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
}

// enum OPENINGHOURS {
//   OPEN_NOW
// }

model GglPhotos {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  height             Int?
  width              Int?
  html_attributuions String?
  photo_reference    String

  gglNearbySearchRes GglNearbySearchRes[]
}

model GglPlusCode {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  compund_code String
  global_code  String

  gglNearbySearchRes GglNearbySearchRes[]
}

model Gglgeometry {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  location           String
  viewport           String
  GglNearbySearchRes GglNearbySearchRes[]
}

model GglNearbySearchResType {
  id                 Int                  @id @default(autoincrement())
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @default(now())
  GglNearbySearchRes GglNearbySearchRes[]
  value              String               @unique
}

/// 구글 nearbySearch 검색 결과
/// google document: https://developers.google.com/maps/documentation/places/web-service/search-nearby?hl=ko
model GglNearbySearchRes {
  id                    Int                      @id @default(autoincrement())
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @default(now())
  geometry              Gglgeometry?             @relation(fields: [gglgeometryId], references: [id])
  gglgeometryId         Int?
  icon                  String?
  icon_background_color String?
  icon_mask_base_uri    String?
  name                  String? /// 검색된 장소 이름 
  opening_hours         Boolean /// 검색시각 기준으로 현재 영업 상태인지
  place_id              String? /// 구글이 부여한 place의 고유값
  price_level           Int? /// 구글이 부여한 가격 레벨, 0-4
  rating                Float? /// 별점, 0-5 
  types                 GglNearbySearchResType[] /// 장소 타입, 문서참조: https://developers.google.com/maps/documentation/places/web-service/supported_types?hl=ko#table2
  user_ratings_total    Int? /// 별점을 준 유저수
  vicinity              String? /// 주소
  plus_code             GglPlusCode?             @relation(fields: [plus_codeId], references: [id]) /// 위경도 기준으로 1/8000 도로 나누어 14m x 14m 범위로 쪼갠 character 주소 체계
  plus_codeId           Int?
  photos                GglPhotos[] /// 장소 사진 url
  QueryParams           QueryParams?             @relation(fields: [queryParamsId], references: [id])
  queryParamsId         Int?
}

/// 프론트에서는 주변장소 검색과 호텔등의 여러 외부 api를 아울러 한번에 스케쥴을 요청하기 때문에 단일 요청에 단일 QueryParams로 대응시켜 구글 GglnearbySearchRes, SearchHotelRes 를 하나로 묶음.
model QueryParams {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  keyword   String? /// searching keyword with or without latitude & longitude ex) hawaii, Matriott Hotel, surfing, best restaurant...
  latitude  Float /// -90 ~ 90
  longitude Float /// -180 ~ 180 
  radius    Float? /// unit: km, ex) 20

  // https://rapidapi.com/tipsters/api/booking-com/  => GET Search hotels by coordinates api
  hotelOrderBy             String? /// Title: HotelsSearchOrderBy, Enum: popularity,class_ascending,class_descending,distance,upsort_bh,review_score,price, ex) popularity
  hotelAdultsNumber        Int? /// Title: Adults Number, Maximum: 29, Minimum: 1 Description: Number of adults, ex) 2
  hotelUnits               String? /// metric | imperial ex) metric
  hotelRoomNumber          Int? ///  Number of rooms ex) 1
  hotelCheckinDate         DateTime? /// 유저가 입력한 여행 시작일 '2022-09-30';
  hotelCheckoutDate        DateTime? ///  유저가 입력한 여행 종료일 '2022-10-01';
  hotelFilterByCurrency    String? /// default USD, 'USD' | 'KRW'; 
  hotelChildrenAges        String? /// booking.com 기준 ex) 유아 연령 배열 '5,3'
  hotelChildrenNumber      Int? /// booking.com 기준 ex) 유아 수 ex) 2
  hotelCategoriesFilterIds String? /// booking.com 기준 호텔 검색시 필터 옵션 bookingComFilterCategories 참조 ex) "property_type::204, property_type::220, class::5, cancellation::1"
  hotelIncludeAdjacency    Boolean?
  searchHotelRes           SearchHotelRes[]
  gglNearbySearchRes       GglNearbySearchRes[]
}

model SearchHotelRes {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  min_total_price                   Float /// ex) 572.61373972
  gross_amount_per_night            Float @default(-1) /// ex) 1박당 요금 = min_total_price / 여행박수
  gross_amount                      Float /// 총액, 부가세등의 세금과, 할인 금액을 계산한 최종 지불금액 ex) 572.61373972
  included_taxes_and_charges_amount Float /// 세금 포함한 금액
  net_amount                        Float /// 순액
  // all_inclusive_amount              Float /// 모두 포함한 금액 (?) <= 결과값으로 미루어 총액과 대부분 동일했음

  countrycode             String /// ex) en
  default_language        String /// ex) xu
  address                 String /// ex) 92-161 Waipahe Place
  city                    String /// ex) "Waianae",
  city_name_en            String /// ex) "Waianae",
  checkin                 String /// ex) {"until":"11:00","from":"10:00"}
  checkout                String /// ex) {"until":"11:00","from":"10:00"}
  distance                Float /// search한 geo location으로부터 거리 ex) 5.62
  review_score_word       String /// ex) Wonderful
  review_score            Float? /// ex) 8.2
  // currency                String /// ex) USD
  currency_code           String /// ex) USD
  timezone                String /// ex) "Pacific/Honolulu",
  urgency_message         String? ///ex) "Only 1 left at this price on Booking.com"
  hotel_id                Int /// ex) 174704674
  // hotel_name_trans     String /// 호텔이름으로 보임 ex) "Marriott's Ko Olina Beach Club"
  hotel_name              String ///  ex) Marriott's Ko Olina Beach Club
  latitude                Float /// 호텔 위도 ex) 21.3307348165897
  longitude               Float /// 호텔 경도 ex) -158.121508732438
  url                     String /// booking.com 예약 페이지 ex) https://www.booking.com/hotel/us/marriott-s-ko-olina-beach-club.html
  accommodation_type_name String /// ex) Resort, Hotel, Homestay, Vacation Home, etc ...
  zip                     String /// ex) HI 96792
  main_photo_url          String /// 대문 썸네일 ex) https://cf.bstatic.com/xdata/images/hotel/square60/280522794.jpg
  max_photo_url           String /// ex) https://cf.bstatic.com/xdata/images/hotel/max1280x900/280522794.jpg?k=bb16655bb4b95d3e5fdefaf39c1fbe4b1150e7eb3062b92eb635ad20b00404fb&o=
  hotel_facilities        String  @db.Text /// ex) "160,467,502,96,220,75,446,498,485,490,484,2,486,444,65,445,450,20,195,458,494,124,3,72,495,488,301,457,4,456,224,434,435,145,225,503,419,185,11,420,497,184,454,436,455,109,468,437,440,496,51,460,448,433,23,441,179,505,504,7,461,104,493,459,421,48,442,439,47,506,107,25,499,422,81,108,451,492,28,253,449,222,305,182,489,16,22,8,491,159,418,161,80,49,443,117"
  // has_swimming_pool       Int /// ex) 1

  QueryParams   QueryParams @relation(fields: [queryParamsId], references: [id])
  queryParamsId Int
}

/// 개발용 booking.com hotels mock data type 구분용
enum BookingComReqType {
  SEARCH_HOTELS_BY_COORDINATES
  SEARCH_LOCATIONS
  FILTERS_FOR_SEARCH
  SEARCH_HOTELS
}

/// 개발용, booking.com hotel 검색 api 쿼리 비용을 줄이기 위해 mydb에 저장할수 있도록 model을 마련함
model MockBookingDotComHotelResource {
  id           Int               @id @default(autoincrement())
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @default(now())
  reqType      BookingComReqType @default(SEARCH_HOTELS_BY_COORDINATES) /// 개발용 booking.com hotels mock data type 구분용
  responseData String            @db.LongText
}

model NonMembersCount {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

/// 카드 뉴스 1장에 대응하는 모델
model CardNewsContent {
  id              Int           @id @default(autoincrement())
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @default(now())
  no              Int
  title           String
  content         String
  bgPicUri        String        @db.Text
  cardNewsGroup   CardNewsGroup @relation(fields: [cardNewsGroupId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  cardNewsGroupId Int
}

/// 각 카드 뉴스 여러장을 갖는 카드 뉴스기사 전체 한편에 대응하는 모델
model CardNewsGroup {
  id              Int               @id @default(autoincrement())
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @default(now())
  title           String
  thumbnailUri    String            @db.Text
  cardNewsContent CardNewsContent[]
  no              Int
  cardTag         CardTag[]
}

model CardTag {
  id            Int             @id @default(autoincrement())
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @default(now())
  value         String          @unique
  cardNewsGroup CardNewsGroup[]
}
